sap.ui.define(["./BaseController","sap/ui/core/Fragment","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/m/IconTabBar","sap/m/IconTabFilter","sap/ui/model/json/JSONModel","sap/m/MessageToast","sap/ui/model/odata/v2/ODataModel","sap/m/MessageBox","sap/ui/core/UIComponent","sap/m/GenericTile","sap/m/TileContent","sap/m/ImageContent","sap/m/Text","sap/ui/comp/library","sap/ui/model/type/String","sap/m/ColumnListItem","sap/m/Label","sap/m/SearchField","sap/m/Token","sap/ui/table/Column","sap/m/Column"],function(e,t,o,s,i,a,n,r,l,d,c,u,g,h,p,m,y,w,I,f,b,P,v){"use strict";return e.extend("com.app.artihcus.controller.MainPage",{onInit:function(){this.ogenerictitesIdarray=[];this.oObject={"14FT":"https://www.searates.com/design/images/apps/load-calculator/20st.svg","14FTF":"https://www.searates.com/design/images/apps/load-calculator/20ref.svg","17FT":"https://www.searates.com/design/images/apps/load-calculator/40st.svg","17FTF":"https://www.searates.com/design/images/apps/load-calculator/40ref.svg","22FT":"https://www.searates.com/design/images/apps/load-calculator/40hq.svg","22FTF":"https://www.searates.com/design/images/apps/load-calculator/40ref.svg","32FT":"https://www.searates.com/design/images/apps/load-calculator/40hq.svg","32FTF":"https://www.searates.com/design/images/apps/load-calculator/40ref.svg"};let e=this.oObject["14ft"];console.log(e);const t=new sap.ui.model.json.JSONModel({products:[]});this.getView().setModel(t,"oJsonModelProd");this.loadProductsFromLocalStorage();this.localModel=new sap.ui.model.json.JSONModel;this.getView().setModel(this.localModel,"localModel");const o=new n({Product:{sapProductno:"",length:"",width:"",height:"",volume:"",uom:"",vuom:"",wuom:"",muom:"",mCategory:"",description:"",EAN:"",weight:"",color:""},Vehicle:{truckType:"",length:"",width:"",height:"",uom:"",tvuom:"MÂ³",tuom:"M",volume:"",truckWeight:"",capacity:"",freezed:""}});this.getView().setModel(o,"CombinedModel");const s=new n({TotalQuantity:"",TotalVolume:"",TotalWeight:"",RemainingCapacity:""});this.getView().setModel(s,"Calculation");const i=new sap.ui.model.json.JSONModel({chartData:[]});const a=new sap.ui.model.json.JSONModel;this.getView().setModel(i,"ChartData")},_createGenericTile:async function(){console.log("Called");var e=this.getView().byId("idVBoxInSelectVehicleType");var t=this;const o=this.getOwnerComponent().getModel("ModelV2"),s="/TruckTypes";var i={"14FT":"https://www.searates.com/design/images/apps/load-calculator/20st.svg","14FTF":"https://www.searates.com/design/images/apps/load-calculator/20ref.svg","17FT":"https://www.searates.com/design/images/apps/load-calculator/40st.svg","17FTF":"https://www.searates.com/design/images/apps/load-calculator/40ref.svg","22FT":"https://www.searates.com/design/images/apps/load-calculator/40hq.svg","22FTF":"https://www.searates.com/design/images/apps/load-calculator/40ref.svg","32FT":"https://www.searates.com/design/images/apps/load-calculator/40hq.svg","32FTF":"https://www.searates.com/design/images/apps/load-calculator/40ref.svg"};function a(e){if(e<14){return 14}else if(e>=14&&e<=16){return 14}else if(e>=17&&e<=21){return 17}else if(e>=22&&e<=31){return 22}else if(e>=32){return 32}return e}try{const n=await this.readData(o,s,[]);n.results.forEach(function(o){let s=o.truckType;let n=s.match(/\d+/g);let r=parseInt(n.join(""));let l=a(r);console.log(r);if(o.freezed){var d=o.truckType+"_f";var c=i[`${l}FTF`]}else{var d=o.truckType;var c=i[`${l}FT`]}if(!t.ogenerictitesIdarray.includes(d)){t.ogenerictitesIdarray.push(d);var p=new u({id:`id_generictile_${d}`,header:`${o.truckType}`,width:"150px",press:t.onPressGenericTilePress.bind(t)});p.addStyleClass("sapUiSmallMarginEnd sapUiTinyMarginTop");var m=new g({id:`id_idTileContent_${d}`});var y=new h({id:`id_idImageContentN_${d}`,src:`${c}`});m.setContent(y);p.addTileContent(m);e.addItem(p)}})}catch(e){console.log(e);r.show(e)}},onlivechangeValue_:function(e){var t=e.getSource();var o=t.getBindingContext();var s=parseFloat(t.getValue());var i=parseFloat(o.getProperty("quantity"));if(s>i){t.setValueState(sap.ui.core.ValueState.Error);t.setValueStateText("Picking Quantity cannot be greaterthan Actual Quantity.")}else if(s<=0){t.setValueState(sap.ui.core.ValueState.Error);t.setValueStateText("Picking Quantity cannot be lessthan or equal to zero.")}else{t.setValueState(sap.ui.core.ValueState.None);t.setValueStateText("")}},onDeletePressInSimulate:async function(){var e=this.getOwnerComponent().getModel("ModelV2");await e.read("/SelectedProduct",{success:function(t){t.results.forEach(t=>{var o=t.ID;this.deleteData(e,`/SelectedProduct('${o}')`)})}.bind(this),error:function(){}});this.byId("idAddProductsTableIn_simulate")?.getBinding("items")?.refresh()},onAddPress:function(){var e=this.byId("idTableAddProduct");var t=e.getSelectedItems();let o=0;var s=this.getOwnerComponent().getModel("ModelV2");if(t.length>0){var i=[];t.forEach(function(e){var t=e.getBindingContext();var s=t.getObject();var i=e.getCells()[4].mProperties;var a=i.value;var n=s.quantity;if(parseInt(a)>parseInt(n)||parseInt(a)<=0||!a){o=o+1}});if(o>0){r.show("Please Enter correct data");return}else{this.onAddPress1(t,s)}}else{r.show("Please select atleast one product")}},onAddPress1:function(e,t){debugger;var i=this;if(e.length>0){var a=[];e.forEach(async function(e){var n=e.getBindingContext();var l=n.getObject();var d=e.getCells()[4].mProperties;var c=d.value;var u={Productno_ID:l.ID,SelectedQuantity:c};a.push({product:l.sapProductno,description:l.description,actualQuantity:l.quantity,pickingQuantity:c});try{var g=await i.productExists(t,u.Productno_ID);if(!g){await i.createData(t,u,"/SelectedProduct");i.byId("idAddProductsTableIn_simulate")?.getBinding("items")?.refresh();return}await t.read("/SelectedProduct",{filters:[new o("Productno_ID",s.EQ,u.Productno_ID)],success:async function(e){console.log(e);var o=e.results[0].ID;await t.update("/SelectedProduct('"+o+"')",{SelectedQuantity:c},{success:function(){i.byId("idAddProductsTableIn_simulate")?.getBinding("items")?.refresh()}.bind(this),error:function(e){sap.m.MessageBox.error("Failed "+e.message)}.bind(this)})},error:function(e){console.log(e)}})}catch(e){console.log(e);r.show(e)}});this.oValueDialog.close()}else{r.show("No rows selected.")}},onCancelPress_valueHelp:function(){this.oValueDialog.close()},productExists:function(e,t){const i=this;return new Promise((i,a)=>{e.read("/SelectedProduct",{filters:[new o("Productno_ID",s.EQ,t)],success:function(e){i(e.results.length>0)},error:function(){a("An error occurred while checking username existence.")}})})},handleValueHelp:function(e){var o=e.getSource().getValue(),s=this.getView();if(!this._pValueHelpDialog){this._pValueHelpDialog=t.load({id:s.getId(),name:"com.app.artihcus.fragment.ProductsDialog",controller:this}).then(function(e){s.addDependent(e);return e})}this._pValueHelpDialog.then(function(e){e.open(o)})},handleValueHelpProductType:function(e){var o=e.getSource().getValue(),s=this.getView();if(!this._pProductsDialog){this._pProductsDialog=t.load({id:s.getId(),name:"com.app.artihcus.fragment.vehicleTypeDialog",controller:this}).then(function(e){s.addDependent(e);return e})}this._pProductsDialog.then(function(e){e.open(o)})},onPrintPressInProductsTable:function(){var e=this.byId("ProductsTable");var t=e.getItems();var o=[];var s=["SAP Productno","Description","EAN","Material Category","Length","Width","Height","Volume","UOM","Weight","Quantity","Layers","Mass","Layers_height"];o.push(s);t.forEach(function(e){var t=e.getCells();var s=[];t.forEach(function(e){s.push(e.getText())});o.push(s)});var i=XLSX.utils.aoa_to_sheet(o);var a=XLSX.utils.book_new();XLSX.utils.book_append_sheet(a,i,"ProductsTable");XLSX.writeFile(a,"ProductsTable.xlsx")},onPressDownloadInAddContainerTable:function(){var e=this.byId("idContainerTypeTable");var t=e.getItems();var o=[];var s=["TruckType","Length(M)","Width(M)","Height(M)","Volume(M)","Capacity","TruckWeight"];o.push(s);t.forEach(function(e){var t=e.getCells();var s=[];t.forEach(function(e){s.push(e.getText())});o.push(s)});var i=XLSX.utils.aoa_to_sheet(o);var a=XLSX.utils.book_new();XLSX.utils.book_append_sheet(a,i,"idProductsTableEdit");XLSX.writeFile(a,"ContainerTable.xlsx")},onPressPrintInListTable:function(){var e=this.byId("idListTable");var t=e.getItems();var o=[];var s=["S.No","Vehicle","Vehicle Type","Product","Product Type","Product Description","Dimensions","Volume","Weight","Capacity Used","Remaining Capacity"];o.push(s);t.forEach(function(e){var t=e.getCells();var s=[];t.forEach(function(e){s.push(e.getText())});o.push(s)});var i=XLSX.utils.aoa_to_sheet(o);var a=XLSX.utils.book_new();XLSX.utils.book_append_sheet(a,i,"idListTable");XLSX.writeFile(a,"ListOfProductsInContainer.xlsx")},onPressInAddEquipment:async function(){if(!this.oCreateContainerDialog){this.oCreateContainerDialog=await this.loadFragment("CreateContainer")}this.oCreateContainerDialog.open()},onCancelInCreateVehicleDialog:function(){this.byId("idCreateInContainerDialog").close();this.ClearVeh()},oOpenProductEdit:async function(){if(!this.oEditDialog){this.oEditDialog=await this.loadFragment("EditProductDialog")}this.oEditDialog.open()},onCancelInEditProductDialog:function(){this.byId("idEditProductDssialog").close()},onPressEditInAddEquipmentTable:async function(){if(!this.oEditInAddEquipment){this.oEditInAddEquipment=await this.loadFragment("EditContainer")}this.oEditInAddEquipment.open()},onCancelInEditVehicleDialog:function(){this.byId("idEditContainerDialog").close()},onPressAddInListTable:async function(){if(!this.oCreateInListDialog){this.oCreateInListDialog=await this.loadFragment("CreateInList")}this.oCreateInListDialog.open()},onCancelInListCreateDialog:function(){this.byId("idListssCreateDialog").close()},onPressEditInListTable:async function(){if(!this.oListEditDialog){this.oListEditDialog=await this.loadFragment("ListEditDialog")}this.oListEditDialog.open()},onCancelInListEditDialog:function(){this.byId("idListEdiwtDialog").close()},onCreateProduct:async function(){const e=function(){const e="0123456789ABCDEF";let t="#";for(let o=0;o<6;o++){t+=e[Math.floor(Math.random()*16)]}return t}();const t=this.getView().getModel("CombinedModel"),o=t.getProperty("/Product"),s=this.getView().getModel("ModelV2"),i=this.getView(),a="/Materials";const n=[];const l=(e,t,o,s)=>{const a=i.byId(e);if(!t||o&&!o.test(t)){a.setValueState("Error");a.setValueStateText(s);n.push(s)}else{a.setValueState("None")}};const c=[{Id:"idDesvbncriptionInput_InitialView",value:o.EAN,regex:null,message:"Please enter EAN"},{Id:"idDescriptionInput_InitialView",value:o.sapProductno,regex:null,message:"Enter SAP product number"},{Id:"idInstanceNumberInput_InitialView",value:o.length,regex:/^\d+(\.\d+)?$/,message:"Length should be numeric"},{Id:"idClientInput_InitialView",value:o.width,regex:/^\d+(\.\d+)?$/,message:"Width should be numeric"},{Id:"idApplicationServerInput_InitialView",value:o.height,regex:/^\d+(\.\d+)?$/,message:"Height should be numeric"},{Id:"idSystemIdInput_InitialView",value:o.mCategory,regex:null,message:"Enter category"},{Id:"idInputDes_InitialView",value:o.description,regex:null,message:"Enter description"},{Id:"idWeightinput_InitialView",value:o.weight,regex:/^\d+$/,message:"Weight should be numeric"},{Id:"idApplicationServerInput_MainPage",value:o.quantity,regex:/^\d+$/,message:"Quantity should be numeric"}];c.forEach(async e=>{l(e.Id,e.value,e.regex,e.message)});if(n.length>0){d.information("Please enter correct data");return}var u=this.byId("idselectuom").getSelectedKey();if(u==="Select"){d.error("Please Select UOM!!");return}o.uom=u;var g=this.byId("uomSelect").getSelectedKey();if(g==="Select"){d.error("Please Select UOM!!");return}o.muom="PC";o.vuom="MÂ³";o.wuom=g?g:"";var h;o.color=e;if(o.uom==="CM"){h=o.length/100*(o.width/100)*(o.height/100);o.volume=String(h.toFixed(7))}else{h=o.length*o.width*o.height;o.volume=String(h.toFixed(7))}try{await this.createData(s,o,a);this.getView().byId("ProductsTable").getBinding("items").refresh();this.byId("idselectuom").setSelectedKey("");this.byId("uomSelect").setSelectedKey("");r.show("Successfully Created!");this.getView().getModel("CombinedModel").setProperty("/Product",{});r.show("Successfully Created!")}catch(e){console.error(e);if(e.statusCode==="400"&&JSON.parse(e.responseText).error.message.value.toLowerCase()==="entity already exists"){d.information("Product Number and EAN Should be unique enter different values")}else{r.show("Facing technical issue")}}},ClearingModel:function(){const e=this.getView().getModel("CombinedModel");e.setProperty("/Product",{sapProductno:"",length:"",width:"",height:"",volume:"",uom:"",mCategory:"",description:"",EAN:"",weight:"",quantity:""})},onProductDel:async function(){const e=this.byId("ProductsTable"),t=e.getSelectedItems(),o=this.getView().getModel("ModelV2");if(t.length===0){d.information("Please select at least one product to delete.");return}try{await Promise.all(t.map(async e=>{const t=e.getBindingContext().getPath();await this.deleteData(o,t)}));this.getView().byId("ProductsTable").getBinding("items").refresh();r.show("Successfully Deleted")}catch(e){r.show("Error Occurs")}},onliveContainerSearch:function(e){let t=e.getParameter("newValue");t=t.replace(/\s+/g,"");t=t.toUpperCase();if(t&&t.length>0){const e=new o("truckType",s.Contains,t),a=new o("capacity",s.Contains,t);var i=new o([e,a])}var a=this.byId("ProductsTable").getBinding("items");a.filter(i)},onCreateContainer:async function(){const e=this.getView().getModel("CombinedModel"),t=e.getProperty("/Vehicle"),o=this.getView().getModel("ModelV2"),s="/TruckTypes";if(!t.truckType||!t.length||!t.width||!t.height||!t.truckWeight||!t.capacity){d.warning("Please Enter all Values");return}const i=this.byId("idFreezedInput").getSelectedKey();if(!i){d.warning("Please Enter all Values");return}const a=i==="Yes"?true:false;t.freezed=a;t.truckType=`${t.truckType}FT`;var n=String(t.length)*String(t.width)*String(t.height);t.volume=parseFloat(n).toFixed(2);var l=this.byId("idContainerTypeUOM").getSelectedItem();t.uom=l?l.getKey():"";try{await this.createData(o,t,s);this.getView().getModel("CombinedModel"),e.setProperty("/Vehicle",{}),this.byId("idContainerTypeTable").getBinding("items").refresh();this.onCancelInCreateVehicleDialog();this.byId("idFreezedInput").setSelectedKey("");this.byId("idContainerTypeUOM").setSelectedKey("");r.show("Successfully Created!")}catch(e){this.byId("idFreezedInput").setSelectedKey("");this.onCancelInCreateVehicleDialog();r.show("Error at the time of creation")}},ClearVeh:function(){const e=this.getView().getModel("CombinedModel");e.setProperty("/Vehicle",{truckType:"",length:"",width:"",height:"",uom:"",volume:"",truckWeight:"",capacity:""})},onContainerDel:async function(){const e=this.byId("idContainerTypeTable"),t=e.getSelectedItems(),o=this.getView().getModel("ModelV2");if(t.length===0){d.information("Please select at least one product to delete.");return}try{await Promise.all(t.map(async e=>{const t=e.getBindingContext().getPath();await this.deleteData(o,t)}));this.getView().byId("idContainerTypeTable").getBinding("items").refresh();r.show("Successfully Deleted")}catch(e){if(e){d.error("Error Occurs");return}}},onRow:function(e){var t=e.getSource()},onEditContainerContainer:async function(){var e=this.byId("idContainerTypeTable").getSelectedItem();if(!e){d.information("Please select at least one Row for edit!");return}const t=e.getBindingContext().getObject();await this.onPressEditInAddEquipmentTable();this.byId("editTruckTypeInput").setValue(t.truckType);this.byId("editLengthInput").setValue(t.length);this.byId("editWidthInput").setValue(t.width);this.byId("editHeightInput").setValue(t.height);this.byId("editTruckWeightInput").setValue(t.truckWeight);this.byId("editCapacityInput").setValue(t.capacity)},onSave:async function(){const e=this.byId("idContainerTypeTable").getSelectedItem().getBindingContext().getObject().freezed,t=this.byId("idSlectOPt").getSelectedKey()==="Yes"?true:false,o=this.getView().getModel("CombinedModel").getProperty("/Vehicle"),s=this.getView();const i=[{Id:"idVehInplength",value:o.length,regex:/^\d+(\.\d+)?$/,message:"Enter length as a numeric value"},{Id:"idVehInpWidth",value:o.width,regex:/^\d+(\.\d+)?$/,message:"Enter width as a numeric value"},{Id:"idVehInpheight",value:o.height,regex:/^\d+(\.\d+)?$/,message:"Enter height as a numeric value"},{Id:"idVehInptruckweight",value:o.truckWeight,regex:/^\d+(\.\d+)?$/,message:"Enter truck weight as numeric value"},{Id:"idVehInpcapacity",value:o.capacity,regex:/^\d+(\.\d+)?$/,message:"Enter capacity"}];let a=[];i.forEach(async e=>{let t=this.validateField(s,e.Id,e.value,e.regex,e.message);if(t.length>0){a.push(t[0])}});if(a.length>0){for(let e of a){d.information(e);return}}let n=this.byId("idSlectOPt").getSelectedKey();if(n==="Select"){d.information("Please select container type");return}const l={truckType:o.truckType,length:o.length,width:o.width,height:o.height,volume:"",truckWeight:this.byId("editTruckWeightInput").getValue(),capacity:this.byId("editCapacityInput").getValue()};var c=String(l.length)*String(l.width)*String(l.height);l.volume=parseFloat(c).toFixed(2);const u=this.byId("editTruckTypeInput").getValue();const g=this.getView().getModel("ModelV2");const h=`/TruckTypes('${u}')`;try{await this.updateData(g,l,h);this.byId("idTruckTypeTable").getBinding("items").refresh();this.onCancelInEditVehicleDialog();this.onClearEditDialog();r.show("Successfully Updated")}catch(e){r.show("Error")}finally{this.byId("idContainerTypeTable").getBinding("items").refresh();this.onCancelInEditVehicleDialog();this.onClearEditDialog();r.show("Error")}},idContainerTypeTable:function(){this.byId("editTruckTypeInput").setValue("");this.byId("editLengthInput").setValue("");this.byId("editWidthInput").setValue("");this.byId("editHeightInput").setValue("");this.byId("editTruckWeightInput").setValue("");this.byId("editCapacityInput").setValue("")},onPressEditInProductsTable:async function(){var e=this.byId("ProductsTable").getSelectedItem();if(!e){d.information("Please select at least one Row for edit!");return}const t=e.getBindingContext().getObject();await this.oOpenProductEdit();this.byId("editProductNoInput").setValue(t.sapProductno);this.byId("editDescriptionInput").setValue(t.description);this.byId("editEANInput").setValue(t.EAN);this.byId("editCategoryInput").setValue(t.mCategory);this.byId("editproLengthInput").setValue(t.length);this.byId("editprodWidthInput").setValue(t.width);this.byId("editprodHeightInput").setValue(t.height);this.byId("editUOMInput").setValue(t.uom);this.byId("editWeightInput").setValue(t.weight);this.byId("editQuantityInput").setValue(t.quantity)},onSaveProduct:async function(){const e={sapProductno:this.byId("editProductNoInput").getValue(),description:this.byId("editDescriptionInput").getValue(),EAN:this.byId("editEANInput").getValue(),mCategory:this.byId("editCategoryInput").getValue(),length:this.byId("editproLengthInput").getValue(),width:this.byId("editprodWidthInput").getValue(),height:this.byId("editprodHeightInput").getValue(),volume:"",uom:this.byId("editUOMInput").getValue(),weight:this.byId("editWeightInput").getValue(),quantity:this.byId("editQuantityInput").getValue()};const t=e;var o=String(t.length)*String(t.width)*String(t.height);t.volume=parseFloat(o).toFixed(2);const s=this.byId("editProductNoInput").getValue();const i=this.getView().getModel("ModelV2");const a=`/Materials('${s}')`;try{await this.updateData(i,t,a);this.getView().byId("ProductsTable").getBinding("items").refresh();this.onCancelInEditProductDialog();this.onClearEditProdDialog();r.show("Successfully Updated")}catch(e){this.onCancelInEditProductDialog();this.onClearEditProdDialog();r.show("Error")}},onClearEditProdDialog:function(){this.byId("editProductNoInput").setValue("");this.byId("editDescriptionInput").setValue("");this.byId("editEANInput").setValue("");this.byId("editCategoryInput").setValue("");this.byId("editproLengthInput").setValue("");this.byId("editprodWidthInput").setValue("");this.byId("editprodHeightInput").setValue("");this.byId("editUOMInput").setValue("");this.byId("editWeightInput").setValue("");this.byId("editQuantityInput").setValue("")},onTruckDetails:function(){const e=this.byId("idcdsse").getValue(),t=this.getView().getModel("ModelV2"),i="/TruckTypes";const a=new o("truckType",s.EQ,e);var n=this;t.read(i,{filters:[a],success:function(e){const t=e.results[0].volume,o=e.results[0].capacity},error:function(e){}})},onProdDetails:function(){const e=this.byId("idproducthelp").getValue(),t=this.getView().getModel("ModelV2"),i="/Materials";const a=new o("sapProductno",s.EQ,e);var n=this;t.read(i,{filters:[a],success:function(e){const t=e.results[0].volume;const o=n.byId("idSystemvgwddshjkIdInput_InitialView").getValue();const s=o/t;n.byId("idSystemvghjdfghkIdIhjnput_InitialView").setValue(s)},error:function(e){}})},onUpload:function(e){this._import(e.getParameter("files")&&e.getParameter("files")[0])},_import:function(e){var t=this;let o=t.getView().getModel("oJsonModelProd"),s=o.getData().products;var i={};if(e&&window.FileReader){var a=new FileReader;a.onload=function(e){var t=e.target.result;var a=XLSX.read(t,{type:"binary"});a.SheetNames.forEach(function(e){i=XLSX.utils.sheet_to_row_object_array(a.Sheets[e])});console.log(i);i.forEach(e=>{if(e.Weight){e.Weight+="KG"}});var n=[...new Set(i)];console.log(n);const r=[...s,...n];localStorage.setItem("productsData",JSON.stringify(r));o.setData({products:r});o.refresh(true)};a.onerror=function(e){console.log(e)};a.readAsBinaryString(e)}},onClickSimulate:async function(){var e=this.byId("idAddProductsTableIn_simulate");var t=e.getSelectedItems();var t=e.getSelectedItems();console.log("Selected Items Count:",t.length);console.log("Selected Items:",t);const o=this.byId("parkingLotSelect");const s=o.getSelectedKey();if(t.length>0){var i=[];t.forEach(function(t){var o=t.getBindingContext("oJsonModelProd");if(o){var s={Product:e.getModel("oJsonModelProd").getProperty("Product",o),MaterialDescription:e.getModel("oJsonModelProd").getProperty("MaterialDescription",o),Quantity:e.getModel("oJsonModelProd").getProperty("Quantity",o),Volume:e.getModel("oJsonModelProd").getProperty("Volume",o),Weight:e.getModel("oJsonModelProd").getProperty("Weight",o)};i.push(s)}else{console.error("Binding context is undefined for a selected item.")}});console.log("Selected Items Data:",i);const a=i.reduce((e,t)=>e+t.Volume,0);function n(e){let t=e.match(/(\d+\.?\d*)/);return t?parseFloat(t[0]):0}const r=i.reduce((e,t)=>e+n(t.Weight),0);console.log("Overall Total Weight:",r);console.log("Overall Total Volume:",a);console.log("Overall Total Volume:",r);await this.onContainerDetailsLoad().then(e=>{let t=[];e.forEach(e=>{if(!s||e.truckType===s){const o=Math.ceil(a/e.volume);const s=o>0?o:1;t.push({truckType:e.truckType,volume:e.volume,numberOfTrucksNeeded:s})}});console.log("Required Trucks for Loading:");t.forEach(e=>{console.log(`- ${e.truckType}: ${e.numberOfTrucksNeeded} truck(s) needed (Capacity: ${e.volume} Kgs)`)});const o={OverallTotalVolume:a,overallTotalWeight:r,Products:i,TProducts:i.length,RequiredTrucks:t};const n=new sap.ui.model.json.JSONModel(o);this.getView().setModel(n,"resultModel");this.getOwnerComponent().setModel(n,"resultModel");const l=this.getView().getModel("resultModel").getData();console.log(l);this.getView().byId("idAddProductsTableIn_simulate").getBinding("items").refresh();this.getView().getModel("resultModel").refresh();this.MoveToNextScreen();this.getView().byId("idAddProductsTableIn_simulate").getBinding("items").refresh();this.getView().getModel("resultModel").refresh()}).catch(e=>{console.error("Error loading truck details:",e)})}else{console.log("No items are selected.")}},onContainerDetailsLoad:function(){return new Promise((e,t)=>{const o="/TruckTypes";const s=this.getView().getModel("ModelV2");s.read(o,{success:function(t){e(t.results)},error:function(e){t(e)}})})},onLoadRequiredTrucks:async function(){if(!this.oReqContainerDialog){this.oReqContainerDialog=await this.loadFragment("RequiredContainer")}this.oReqContainerDialog.setModel(this.getView().getModel("resultModel"),"resultModel");const e=this.getView().getModel("resultModel").getProperty("/Products");const t=e?e.length:0;this.oReqContainerDialog.open()},onTruckDialogClose:function(){this.byId("truckLoadingDialog").close()},MoveToNextScreen:function(){const e=c.getRouterFor(this);e.navTo("ManuvalSimulation")},onLiveBinNumberTAble:function(e){let t=[];let i=e.getParameter("newValue");i=i.replace(/\s+/g,"");i=i.toUpperCase();if(i&&i.length>1){t.push(new o("sapProductno",s.EQ,i))}var a=this.byId("ProductsTable");var n=a.getBinding("items");n.filter(t)},onUploadMaterialCreation:function(e){this._import1(e.getParameter("files")&&e.getParameter("files")[0])},_import1:function(e){var t=this;if(e&&window.FileReader){var o=new FileReader;o.onload=function(e){var o=e.target.result;var s=XLSX.read(o,{type:"binary"});var i=[];s.SheetNames.forEach(function(e){const t=XLSX.utils.sheet_to_row_object_array(s.Sheets[e]);i=i.concat(t)});console.log(i);t.createProducts(i);t.localModel.refresh(true)};o.onerror=function(e){console.error("Error reading file:",e)};o.readAsBinaryString(e)}else{console.error("No file selected or FileReader not supported.")}},createProducts:async function(e){const t=this.getView().getModel("ModelV2");const o="/Materials";const s=[];for(const i of e){try{const e=this.checkProductExists(i["SAP Productno"]);if(e){console.warn(`Product with SAP Productno ${i["SAP Productno"]} already exists. Skipping creation.`);continue}const s={sapProductno:String(i["SAP Productno"]),length:String(i.Length),width:String(i.Width),height:String(i.Height),volume:String(i.Volume),uom:String(i.UOM),mCategory:String(i["Material Category"]),description:String(i.Description),EAN:String(i.EAN),weight:String(i.Weight),quantity:String(i.Quantity)};await this.createData(t,s,o);console.log(`Product created successfully: ${i.Description}`);this.byId("ProductsTable").getBinding("items").refresh()}catch(e){const t=`Error creating product ${i["SAP Productno"]}: ${e.message}`;console.error(t);s.push(t);d.error(t)}}},checkProductExists:function(e){if(!this.existingProducts||!Array.isArray(this.existingProducts)){console.error("existingProducts is not initialized or not an array.");return false}return this.existingProducts.some(t=>t.sapProductno===e)},loadExistingProducts:async function(){const e=this.getView().getModel("ModelV2");const t="/Materials";return new Promise((o,s)=>{e.read(t,{success:e=>{this.existingProducts=e.results;o()},error:e=>{console.error("Error loading existing products:",e);s(e)}})})},onClickSimulate11:function(){this.byId("Productarea").setVisible(false);this.byId("3dSimulator").setVisible(true)},onPressBacktomaterialupload:function(){this.byId("3dSimulator").setVisible(false);this.byId("Productarea").setVisible(true)},onSimulate:function(){var e=this.byId("parkingLotSelect").getSelectedKey();if(!e){d.warning("Please Select Truck Type");return}var t=this.byId("idproducthelp").getValue(),o=this.byId("idSystemvghjdfghkIdIhjnput_InitialView").getValue();if(!t){d.information("Please Enter Material!");return}if(!o){d.information("Please Enter  Quantity!");return}this.oProductRead(t,o)},oProductRead:async function(e,t){const i="/Materials",a=this.getView().getModel("ModelV2");const n=new o("sapProductno",s.EQ,e);try{const o=await this.readData(a,i,n);console.log("success");console.log(o);const s=o.results[0].volume;const l=o.results[0].weight;const d=parseFloat(l);const c=d*t+"KG";const u=s*t;const g=this.getView().getModel("oJsonModelProd");const h={Product:e,MaterialDescription:o.results[0].description,Quantity:t,Volume:u,Weight:c};let p=g.getProperty("/products")||[];p.push(h);g.setProperty("/products",p);this.byId("idproducthelp").setValue();this.byId("idSystemvghjdfghkIdIhjnput_InitialView").setValue();this.Blocking();localStorage.setItem("productsData",JSON.stringify(p));r.show("Materials read successfully!")}catch(e){d.warning("Please Enter Valid Material")}},Blocking:function(){var e=this.byId("idAddProductsTableIn_simulate").getItems().length;if(e>0){this.byId("parkingLotSelect").setEditable(false)}},loadProductsFromLocalStorage:function(){const e=this.getView().getModel("oJsonModelProd");if(!e){console.error("JSON Model 'oJsonModelProd' is not defined.");return}const t=localStorage.getItem("productsData");if(t){const o=JSON.parse(t);console.log("Loaded products from local storage:",o);if(Array.isArray(o)){e.setProperty("/products",o);console.log("Products set in model:",e.getProperty("/products"));this.getView().getModel("oJsonModelProd").refresh(true)}else{console.error("Loaded data is not an array:",o)}}else{console.log("No products found in local storage.")}},onRemoveSelectedProducts:function(){const e=this.getView().getModel("oJsonModelProd");const t=this.getView().byId("idAddProductsTableIn_simulate");const o=t.getSelectedItems();if(o.length>0){const s=e.getProperty("/products");const i=o.map(e=>e.getBindingContext("oJsonModelProd").getProperty("Product"));console.log("Selected Keys:",i);console.log("All Products:",s);const a=s.filter(e=>{const t=i.includes(e.Product);console.log(`Checking product: ${e.Product}, is selected: ${t}`);return!t});console.log("Filtered Products:",a);e.setProperty("/products",a);localStorage.setItem("productsData",JSON.stringify(a));t.getBinding("items").refresh();sap.m.MessageToast.show("Selected products have been removed.");this.Blocking()}else{e.setProperty("/products",[]);localStorage.removeItem("productsData");t.getBinding("items").refresh();sap.m.MessageToast.show("All products have been removed.")}},onNextInAddProduct:function(){var e=this.byId("idWizardIn_simulate");var t=e.getCurrentStep();e.nextStep();this._createGenericTile()},onPressStackBtn:async function(){if(!this.oStackDialog){this.oStackDialog=await this.loadFragment("Stack")}this.oStackDialog.open()},onCancelInStackDialog:function(){this.oStackDialog.close()},_createGenericStackTile:function(){var e=this.byId("VboxIdStacktiles")},onNextPressInSeconsSrInAddVehicleType:function(){debugger;this.getView().byId("idProcessQueueStep_changeQueue").setVisible(true)},onPressGenericTilePress:function(e){debugger;var t=this.byId("idWizardIn_simulate");var i=t.getCurrentStep();t.nextStep();const a=e.getSource();const n=a.getHeader();this._init3DScene();const r=this.getOwnerComponent().getModel("ModelV2");const l="/TruckTypes";const d=new o("truckType",s.EQ,n);r.read(l,{filters:[d],success:function(e){if(e.results.length>0){const t=parseFloat(e.results[0].height);const o=parseFloat(e.results[0].length);const s=parseFloat(e.results[0].width);this._createContainer(t,o,s)}else{console.error("No data found for the selected truck type.")}}.bind(this),error:function(e){console.error("Error fetching truck type data:",e)}})},onPressAddProductInSimulate:async function(){debugger;if(!this.oValueDialog){this.oValueDialog=await this.loadFragment("ValueHelp")}this.oValueDialog.open()},onValueHelpWithSuggestionsCancelPress:function(){this._oVHDWithSuggestions.close()},onPressTile:function(e){var t=e.getSource().getHeader();var o={Box:["https://www.searates.com/design/images/apps/load-calculator/boxes-layers.svg","https://www.searates.com/design/images/apps/load-calculator/boxes-height.svg","https://www.searates.com/design/images/apps/load-calculator/boxes-mass.svg"],Bigbags:["https://www.searates.com/design/images/apps/load-calculator/product-form/bigbags-layers.svg","https://www.searates.com/design/images/apps/load-calculator/product-form/bigbags-mass.svg","https://www.searates.com/design/images/apps/load-calculator/product-form/bigbags-height.svg"],Sacks:["https://www.searates.com/design/images/apps/load-calculator/product-form/sacks-layers.svg?3","https://www.searates.com/design/images/apps/load-calculator/product-form/sacks-height.svg?3","https://www.searates.com/design/images/apps/load-calculator/product-form/sacks-mass.svg?3"],Barrels:["https://www.searates.com/design/images/apps/load-calculator/barrels-layers.svg","https://www.searates.com/design/images/apps/load-calculator/barrels-height.svg","https://www.searates.com/design/images/apps/load-calculator/barrels-mass.svg"],Roll:["https://www.searates.com/design/images/apps/load-calculator/rolls-layers.svg","https://www.searates.com/design/images/apps/load-calculator/rolls-height.svg","https://www.searates.com/design/images/apps/load-calculator/rolls-mass.svg"],Pipes:["https://www.searates.com/design/images/apps/load-calculator/rolls-layers.svg","https://www.searates.com/design/images/apps/load-calculator/rolls-height.svg","https://www.searates.com/design/images/apps/load-calculator/rolls-mass.svg"],Bulk:[]};if(o[t]){var s=o[t];this.byId("idImageInStack").setSrc(s[0]);this.byId("idImage3InStack").setSrc(s[1]);this.byId("idImage43InStack").setSrc(s[2]);this.byId("imageDisplayHBox").setVisible(true)}},onPressAddButtonValueHelp:function(){var e=this.byId("idAssignedQueueTable_changeQueue");var t=e.getSelectedItems()},onPressBigBagsTile:function(){var e=new n({});this.getView().byId("idVbox4InStack").setModel(e,"oimage");var t=this.getView().byId("idVbox4InStack").getModel();const o=this.getView().byId("idVbox4InStack").getModel("oimage").getProperty("/");console.log(o)},_init3DScene:function(){if(this.scene){while(this.scene.children.length>0){this.scene.remove(this.scene.children[0])}}else{this.scene=new THREE.Scene;this.scene.background=new THREE.Color(16753920)}if(this.renderer){this.renderer.domElement.remove();this.renderer.dispose()}this.renderer=new THREE.WebGLRenderer({alpha:true});const e=document.getElementById("threejsCanvas");if(!e){console.error("Canvas container not found");return}this.renderer.setSize(800,600);this.renderer.outputEncoding=THREE.sRGBEncoding;this.renderer.shadowMap.enabled=true;e.appendChild(this.renderer.domElement);this.camera=new THREE.PerspectiveCamera(40,1e3/700,.1,1e3);this.camera.position.set(10,10,20);this.controls=new THREE.OrbitControls(this.camera,this.renderer.domElement);this.controls.enableDamping=true;this._addLighting();this._animate()},_createContainer:function(e,t,o){if(this.container){this.scene.remove(this.container);this.container.geometry.dispose();this.container.material.dispose()}const s=new THREE.BoxGeometry(t,e,o);const i=new THREE.MeshPhysicalMaterial({color:31743,metalness:.8,roughness:.4,opacity:.5,transparent:true,side:THREE.DoubleSide});this.container=new THREE.Mesh(s,i);this.container.castShadow=true;this.container.receiveShadow=true;this.container.position.set(0,e/2,0);this.scene.add(this.container);console.log("Container created with dimensions:",{height:e,length:t,width:o});const a=this.getView().byId("idAddProductsTableIn_simulate");const n=a.getSelectedItems();const r=n.map(e=>e.getBindingContext().getObject());console.log("Selected Items Data as Objects:",r);this._createProducts(r,e,t,o)},_createProducts:function(e,t,o,s){let i=-o/2;let a=-s/2;let n=0;const r=[];const l=[];let d=0;let c=0;let u=0;const g=t*o*s;const h=1e3;e.forEach(e=>{const t=parseInt(e.SelectedQuantity);const g=Math.max(parseFloat(e.Productno.length),.01);const h=Math.max(parseFloat(e.Productno.height),.01);const p=Math.max(parseFloat(e.Productno.width),.01);const m=e.Productno.color;const y=parseFloat(e.Productno.weight);const w=e.Productno.description;let I=0;let f=0;for(let e=0;e<t;e++){let e=true;while(e){if(i+g>o/2){i=-o/2;a+=p;if(a+p>s/2){a=-s/2;n+=h}}e=r.some(e=>i<e.xEnd&&i+g>e.xStart&&a<e.zEnd&&a+p>e.zStart&&n<e.yTop);if(e){i+=g}}if(!e){const e=new THREE.BoxGeometry(g,h,p);const t=new THREE.MeshStandardMaterial({color:new THREE.Color(m),metalness:.5,roughness:.5});const o=new THREE.Mesh(e,t);o.position.set(i+g/2,n+h/2,a+p/2);this.scene.add(o);const s=new THREE.EdgesGeometry(e);const l=new THREE.LineBasicMaterial({color:0});const w=new THREE.LineSegments(s,l);w.position.copy(o.position);this.scene.add(w);r.push({xStart:i,xEnd:i+g,zStart:a,zEnd:a+p,yTop:n+h});d++;const b=g*h*p;c+=b;u+=y;I+=b;f+=y;i+=g}}l.push({Name:w,Packages:t,Volume:I.toFixed(1),Weight:f.toFixed(1),Color:m})});const p=g-c;const m=h-u;l.push({Name:"Empty",Packages:0,Volume:p.toFixed(1),Weight:0,Color:"#cccccc"});this.getView().getModel("ChartData").setProperty("/chartData",l);this.getView().getModel("Calculation").setProperty("/",{TotalQuantity:d,TotalVolume:`${c.toFixed(1)} mÂ³ (${(c/g*100).toFixed(1)}% filled)`,TotalWeight:`${u.toFixed(1)} kg`,RemainingCapacity:`${p.toFixed(1)} mÂ³ (${(p/g*100).toFixed(1)}% empty)`});const y=this.getView().byId("idPieChart");y.setVizProperties({plotArea:{colorPalette:l.map(e=>e.Color),dataLabel:{visible:true}},title:{text:"Cargo Volume Breakdown"}})},_addLighting:function(){const e=new THREE.AmbientLight(16777215,.8);this.scene.add(e);const t=[{x:50,y:50,z:50},{x:-50,y:50,z:50},{x:50,y:50,z:-50},{x:-50,y:50,z:-50}];t.forEach(e=>{const t=new THREE.DirectionalLight(16777215,.5);t.position.set(e.x,e.y,e.z);this.scene.add(t)})},_animate:function(){const e=()=>{requestAnimationFrame(e);this.controls.update();this.renderer.render(this.scene,this.camera)};e()},onDownloadPressInSimulate:function(){var e=this.byId("idAddProductsTableIn_simulate");var t=e.getItems();var o=[];var s=["Product","Description","Quantity","Volume","Weight","Length","Width","Height","Color","Stack"];o.push(s);t.forEach(function(e){var t=e.getCells();var s=[];t.forEach(function(e){s.push(e.getText())});o.push(s)});var i=XLSX.utils.aoa_to_sheet(o);var a=XLSX.utils.book_new();XLSX.utils.book_append_sheet(a,i,"ProductsListTable");XLSX.writeFile(a,"ProductsListTable.xlsx")}})});
//# sourceMappingURL=MainPage.controller.js.map