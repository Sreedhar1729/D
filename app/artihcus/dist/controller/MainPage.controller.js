<<<<<<< HEAD
sap.ui.define(["./BaseController","sap/ui/core/Fragment","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/m/IconTabBar","sap/m/IconTabFilter","sap/ui/model/json/JSONModel","sap/m/MessageToast","sap/ui/model/odata/v2/ODataModel","sap/m/MessageBox","sap/ui/core/UIComponent","sap/m/GenericTile","sap/m/TileContent","sap/m/ImageContent","sap/m/Text","sap/ui/comp/library","sap/ui/model/type/String","sap/m/ColumnListItem","sap/m/Label","sap/m/SearchField","sap/m/Token","sap/ui/table/Column","sap/m/Column"],function(e,t,s,o,i,a,n,r,l,c,d,u,g,h,p,m,y,w,I,f,P,b,V){"use strict";return e.extend("com.app.artihcus.controller.MainPage",{onInit:function(){this.oObject={"14FT":"https://www.searates.com/design/images/apps/load-calculator/20st.svg","14FTF":"https://www.searates.com/design/images/apps/load-calculator/20ref.svg","17FT":"https://www.searates.com/design/images/apps/load-calculator/40st.svg","17FTF":"https://www.searates.com/design/images/apps/load-calculator/40ref.svg","22FT":"https://www.searates.com/design/images/apps/load-calculator/40hq.svg","22FTF":"https://www.searates.com/design/images/apps/load-calculator/40ref.svg","32FT":"https://www.searates.com/design/images/apps/load-calculator/40hq.svg","32FTF":"https://www.searates.com/design/images/apps/load-calculator/40ref.svg"};let e=this.oObject["14ft"];console.log(e);const t=new sap.ui.model.json.JSONModel({products:[]});this.getView().setModel(t,"oJsonModelProd");this.loadProductsFromLocalStorage();this.localModel=new sap.ui.model.json.JSONModel;this.getView().setModel(this.localModel,"localModel");const s=new n({sapProductno:"",length:"",width:"",height:"",volume:"",uom:"",vuom:"",wuom:"",muom:"",mCategory:"",description:"",EANUPC:"",weight:""});this.getView().setModel(s,"ProductModel");const o=new n({truckType:"",length:"",width:"",height:"",uom:"",tvuom:"M³",tuom:"M",volume:"",truckWeight:"",capacity:"",freezed:""});this.getView().setModel(o,"VehModel")},_createGenericTile:async function(){console.log("Called");var e=this.byId("idVBoxInSelectVehicleType");var t=this;const s=this.getOwnerComponent().getModel("ModelV2"),o="/TruckTypes";var i={"14FT":"https://www.searates.com/design/images/apps/load-calculator/20st.svg","14FTF":"https://www.searates.com/design/images/apps/load-calculator/20ref.svg","17FT":"https://www.searates.com/design/images/apps/load-calculator/40st.svg","17FTF":"https://www.searates.com/design/images/apps/load-calculator/40ref.svg","22FT":"https://www.searates.com/design/images/apps/load-calculator/40hq.svg","22FTF":"https://www.searates.com/design/images/apps/load-calculator/40ref.svg","32FT":"https://www.searates.com/design/images/apps/load-calculator/40hq.svg","32FTF":"https://www.searates.com/design/images/apps/load-calculator/40ref.svg"};try{const a=await this.readData(s,o,[]);a.results.forEach(function(s){if(s.freezed){var o=s.truckType+"_f";var a=i[`${s.truckType}F`]}else{var o=s.truckType;var a=i[`${s.truckType}`]}var n=new u({id:`id_generictile_${o}`,class:"sapUiLargeMarginTop sapUiTinyMarginEnd tileLayout",header:`${s.truckType}`,width:"150px",press:t.onPressGenericTilePress.bind(t)});var r=new g({id:`id_idTileContent_${o}`});var l=new h({id:`id_idImageContentN_${o}`,src:`${a}`});r.setContent(l);n.addTileContent(r);e.addItem(n);e.addItem(new Text({text:"",width:"10Px"}))})}catch(e){console.log(e);r.show(e)}},onAddPress:function(){var e=this.byId("idTableAddProduct");var t=this;var s=e.getSelectedItems();var o=this.getOwnerComponent().getModel("ModelV2");if(s.length>0){var i=[];s.forEach(function(e){var s=e.getBindingContext();var a=s.getObject();var n=e.getCells()[3];var l=n.getValue();var c={Productno_sapProductno:a.sapProductno,SelectedQuantity:l};i.push({product:a.sapProductno,description:a.description,actualQuantity:a.quantity,pickingQuantity:l});try{var d=t.productExists(o,c.Productno_sapProductno);if(d){console.log("exixts");o.update("/SelectedProduct('"+c.Productno_sapProductno+"')",c,{success:function(){}.bind(this),error:function(e){sap.m.MessageBox.error("Failed "+e.message)}.bind(this)});return}t.createData(o,c,"/SelectedProduct")}catch(e){console.log(e);r.show(e)}});r.show("Selected Products: "+JSON.stringify(i));this.oValueDialog.close()}else{r.show("No rows selected.")}},onPressGenericTilePress:function(){var e=this.byId("idWizardIn_simulate");var t=e.getCurrentStep();e.nextStep()},onCancelPress_valueHelp:function(){this.oValueDialog.close()},productExists:async function(e,t){console.log(t);return new Promise((i,a)=>{e.read("/SelectedProduct",{filters:[new s("Productno_sapProductno",o.EQ,t)],success:function(e){i(e)},error:function(){a("An error occurred while checking username existence.")}})})},handleValueHelp:function(e){var s=e.getSource().getValue(),o=this.getView();if(!this._pValueHelpDialog){this._pValueHelpDialog=t.load({id:o.getId(),name:"com.app.artihcus.fragment.ProductsDialog",controller:this}).then(function(e){o.addDependent(e);return e})}this._pValueHelpDialog.then(function(e){e.open(s)})},handleValueHelpProductType:function(e){var s=e.getSource().getValue(),o=this.getView();if(!this._pProductsDialog){this._pProductsDialog=t.load({id:o.getId(),name:"com.app.artihcus.fragment.vehicleTypeDialog",controller:this}).then(function(e){o.addDependent(e);return e})}this._pProductsDialog.then(function(e){e.open(s)})},onPrintPressInProductsTable:function(){var e=this.byId("ProductsTable");var t=e.getItems();var s=[];var o=["SAP Productno","Description","EANUPC","Material Category","Length","Width","Height","Volume","UOM","Weight","Quantity","Layers","Mass","Layers_height"];s.push(o);t.forEach(function(e){var t=e.getCells();var o=[];t.forEach(function(e){o.push(e.getText())});s.push(o)});var i=XLSX.utils.aoa_to_sheet(s);var a=XLSX.utils.book_new();XLSX.utils.book_append_sheet(a,i,"ProductsTable");XLSX.writeFile(a,"ProductsTable.xlsx")},onPressDownloadInAddVehicleTable:function(){var e=this.byId("idTruckTypeTable");var t=e.getItems();var s=[];var o=["TruckType","Length(M)","Width(M)","Height(M)","Volume(M)","Capacity","TruckWeight"];s.push(o);t.forEach(function(e){var t=e.getCells();var o=[];t.forEach(function(e){o.push(e.getText())});s.push(o)});var i=XLSX.utils.aoa_to_sheet(s);var a=XLSX.utils.book_new();XLSX.utils.book_append_sheet(a,i,"idProductsTableEdit");XLSX.writeFile(a,"VehicleTable.xlsx")},onPressPrintInListTable:function(){var e=this.byId("idListTable");var t=e.getItems();var s=[];var o=["S.No","Vehicle","Vehicle Type","Product","Product Type","Product Description","Dimensions","Volume","Weight","Capacity Used","Remaining Capacity"];s.push(o);t.forEach(function(e){var t=e.getCells();var o=[];t.forEach(function(e){o.push(e.getText())});s.push(o)});var i=XLSX.utils.aoa_to_sheet(s);var a=XLSX.utils.book_new();XLSX.utils.book_append_sheet(a,i,"idListTable");XLSX.writeFile(a,"ListOfProductsInVehicle.xlsx")},onCancelInCreateProductDialog:function(){this.byId("idCreateProduc33tDialog").close()},onPressInAddEquipment:async function(){if(!this.oCreateInAddEquipmentDialog){this.oCreateInAddEquipmentDialog=await this.loadFragment("CreateVehicleType")}this.oCreateInAddEquipmentDialog.open()},onCancelInCreateVehicleDialog:function(){this.byId("idCreateInAddddEquipmentDialog").close();this.ClearVeh()},oOpenProductEdit:async function(){if(!this.oEditDialog){this.oEditDialog=await this.loadFragment("EditProduct")}this.oEditDialog.open()},onCancelInEditProductDialog:function(){this.byId("idEditProductDssialog").close()},onPressEditInAddEquipmentTable:async function(){if(!this.oEditInAddEquipment){this.oEditInAddEquipment=await this.loadFragment("EditTruckType")}this.oEditInAddEquipment.open()},onCancelInEditVehicleDialog:function(){this.byId("idEditInssAddEquipmentDialog").close()},onPressAddInListTable:async function(){if(!this.oCreateInListDialog){this.oCreateInListDialog=await this.loadFragment("CreateInList")}this.oCreateInListDialog.open()},onCancelInListCreateDialog:function(){this.byId("idListssCreateDialog").close()},onPressEditInListTable:async function(){if(!this.oListEditDialog){this.oListEditDialog=await this.loadFragment("ListEditDialog")}this.oListEditDialog.open()},onCancelInListEditDialog:function(){this.byId("idListEdiwtDialog").close()},onCreateProduct:async function(){const e=this.getView().getModel("ProductModel"),t=e.getProperty("/"),s=this.getView().getModel("ModelV2"),o="/Materials";if(!t.sapProductno||!t.length||!t.width||!t.height||!t.mCategory||!t.description||!t.weight||!t.quantity){console.log("Please Enter All Values");c.information("Please Enter All Values");return}var i=this.byId("idselectuom").getSelectedItem();if(i.getKey()===""){c.error("Please Select UOM!!");return}t.uom=i.getKey();var a=this.byId("uomSelect").getSelectedItem();if(a.getKey()===""){c.error("Please Select UOM!!");return}t.muom="PC";t.vuom="M³";t.wuom=a?a.getKey():"";var n;if(t.uom==="CM"){n=String(t.length/100)*String(t.width/100)*String(t.height/100);t.volume=String(n.toFixed(7))}else{n=String(t.length)*String(t.width)*String(t.height);t.volume=String(Math.round(n))}try{await this.createData(s,t,o);debugger;this.getView().byId("ProductsTable").getBinding("items").refresh();this.byId("idselectuom").setSelectedKey("");this.byId("uomSelect").setSelectedKey("");r.show("Successfully Created!");this.ClearingModel(true);r.show("Successfully Created!")}catch(e){r.show("Error at the time of creation")}},ClearingModel:function(){const e=this.getView().getModel("ProductModel");e.setProperty("/",{sapProductno:"",length:"",width:"",height:"",volume:"",uom:"",mCategory:"",description:"",EANUPC:"",weight:"",quantity:""})},onProductDel:async function(){const e=this.byId("ProductsTable"),t=e.getSelectedItems(),s=this.getView().getModel("ModelV2");if(t.length===0){c.information("Please select at least one product to delete.");return}try{await Promise.all(t.map(async e=>{const t=e.getBindingContext().getPath();await this.deleteData(s,t)}));this.getView().byId("ProductsTable").getBinding("items").refresh();r.show("Successfully Deleted")}catch(e){r.show("Error Occurs")}},onCreateVeh:async function(){const e=this.getView().getModel("VehModel"),t=e.getProperty("/"),s=this.getView().getModel("ModelV2"),o="/TruckTypes";if(!t.truckType||!t.length||!t.width||!t.height||!t.truckWeight||!t.capacity){c.warning("Please Enter all Values");return}const i=this.byId("idFreezedInput").getSelectedKey();if(!i){c.warning("Please Enter all Values");return}const a=i==="Yes"?true:false;t.freezed=a;var n=String(t.length)*String(t.width)*String(t.height);t.volume=parseFloat(n).toFixed(2);var l=this.byId("idvehtypeUOM").getSelectedItem();t.uom=l?l.getKey():"";try{await this.createData(s,t,o);debugger;this.ClearVeh();this.byId("idTruckTypeTable").getBinding("items").refresh();this.onCancelInCreateVehicleDialog();this.byId("idvehtypeUOM").setSelectedKey("");this.byId("parkingLotSelect").getBinding("items").refresh();r.show("Successfully Created!")}catch(e){this.onCancelInCreateVehicleDialog();r.show("Error at the time of creation")}},ClearVeh:function(){const e=this.getView().getModel("VehModel");e.setProperty("/",{truckType:"",length:"",width:"",height:"",uom:"",volume:"",truckWeight:"",capacity:""})},onVehDel:async function(){const e=this.byId("idTruckTypeTable"),t=e.getSelectedItems(),s=this.getView().getModel("ModelV2");if(t.length===0){c.information("Please select at least one product to delete.");return}try{await Promise.all(t.map(async e=>{const t=e.getBindingContext().getPath();await this.deleteData(s,t)}));this.getView().byId("idTruckTypeTable").getBinding("items").refresh();this.byId("parkingLotSelect").getBinding("items").refresh();r.show("Successfully Deleted")}catch(e){r.show("Error Occurs")}},onRow:function(e){var t=e.getSource()},onEdit:async function(){var e=this.byId("idTruckTypeTable").getSelectedItem();if(!e){c.information("Please select at least one Row for edit!");return}const t=e.getBindingContext().getObject();await this.onPressEditInAddEquipmentTable();this.byId("editTruckTypeInput").setValue(t.truckType);this.byId("editLengthInput").setValue(t.length);this.byId("editWidthInput").setValue(t.width);this.byId("editHeightInput").setValue(t.height);this.byId("editTruckWeightInput").setValue(t.truckWeight);this.byId("editCapacityInput").setValue(t.capacity)},onSave:async function(){const e={truckType:this.byId("editTruckTypeInput").getValue(),length:this.byId("editLengthInput").getValue(),width:this.byId("editWidthInput").getValue(),height:this.byId("editHeightInput").getValue(),volume:"",truckWeight:this.byId("editTruckWeightInput").getValue(),capacity:this.byId("editCapacityInput").getValue()};const t=e;var s=String(t.length)*String(t.width)*String(t.height);t.volume=parseFloat(s).toFixed(2);const o=this.byId("editTruckTypeInput").getValue();const i=this.getView().getModel("ModelV2");const a=`/TruckTypes('${o}')`;try{await this.updateData(i,t,a);this.byId("idTruckTypeTable").getBinding("items").refresh();this.onCancelInEditVehicleDialog();this.onClearEditDialog();r.show("Successfully Updated")}catch(e){this.onCancelInEditVehicleDialog();this.onClearEditDialog();r.show("Error")}},idTruckTypeTable:function(){this.byId("editTruckTypeInput").setValue("");this.byId("editLengthInput").setValue("");this.byId("editWidthInput").setValue("");this.byId("editHeightInput").setValue("");this.byId("editTruckWeightInput").setValue("");this.byId("editCapacityInput").setValue("")},onPressEditInProductsTable:async function(){var e=this.byId("ProductsTable").getSelectedItem();if(!e){c.information("Please select at least one Row for edit!");return}const t=e.getBindingContext().getObject();await this.oOpenProductEdit();this.byId("editProductNoInput").setValue(t.sapProductno);this.byId("editDescriptionInput").setValue(t.description);this.byId("editEANUPCInput").setValue(t.EANUPC);this.byId("editCategoryInput").setValue(t.mCategory);this.byId("editproLengthInput").setValue(t.length);this.byId("editprodWidthInput").setValue(t.width);this.byId("editprodHeightInput").setValue(t.height);this.byId("editUOMInput").setValue(t.uom);this.byId("editWeightInput").setValue(t.weight);this.byId("editQuantityInput").setValue(t.quantity)},onSaveProduct:async function(){const e={sapProductno:this.byId("editProductNoInput").getValue(),description:this.byId("editDescriptionInput").getValue(),EANUPC:this.byId("editEANUPCInput").getValue(),mCategory:this.byId("editCategoryInput").getValue(),length:this.byId("editproLengthInput").getValue(),width:this.byId("editprodWidthInput").getValue(),height:this.byId("editprodHeightInput").getValue(),volume:"",uom:this.byId("editUOMInput").getValue(),weight:this.byId("editWeightInput").getValue(),quantity:this.byId("editQuantityInput").getValue()};const t=e;var s=String(t.length)*String(t.width)*String(t.height);t.volume=parseFloat(s).toFixed(2);const o=this.byId("editProductNoInput").getValue();const i=this.getView().getModel("ModelV2");const a=`/Materials('${o}')`;try{await this.updateData(i,t,a);this.getView().byId("ProductsTable").getBinding("items").refresh();this.onCancelInEditProductDialog();this.onClearEditProdDialog();r.show("Successfully Updated")}catch(e){this.onCancelInEditProductDialog();this.onClearEditProdDialog();r.show("Error")}},onClearEditProdDialog:function(){this.byId("editProductNoInput").setValue("");this.byId("editDescriptionInput").setValue("");this.byId("editEANUPCInput").setValue("");this.byId("editCategoryInput").setValue("");this.byId("editproLengthInput").setValue("");this.byId("editprodWidthInput").setValue("");this.byId("editprodHeightInput").setValue("");this.byId("editUOMInput").setValue("");this.byId("editWeightInput").setValue("");this.byId("editQuantityInput").setValue("")},onTruckDetails:function(){const e=this.byId("idcdsse").getValue(),t=this.getView().getModel("ModelV2"),i="/TruckTypes";const a=new s("truckType",o.EQ,e);var n=this;t.read(i,{filters:[a],success:function(e){const t=e.results[0].volume,s=e.results[0].capacity},error:function(e){}})},onProdDetails:function(){const e=this.byId("idproducthelp").getValue(),t=this.getView().getModel("ModelV2"),i="/Materials";const a=new s("sapProductno",o.EQ,e);var n=this;t.read(i,{filters:[a],success:function(e){const t=e.results[0].volume;const s=n.byId("idSystemvgwddshjkIdInput_InitialView").getValue();const o=s/t;n.byId("idSystemvghjdfghkIdIhjnput_InitialView").setValue(o)},error:function(e){}})},onUpload:function(e){this._import(e.getParameter("files")&&e.getParameter("files")[0])},_import:function(e){var t=this;let s=t.getView().getModel("oJsonModelProd"),o=s.getData().products;var i={};if(e&&window.FileReader){var a=new FileReader;a.onload=function(e){var t=e.target.result;var a=XLSX.read(t,{type:"binary"});a.SheetNames.forEach(function(e){i=XLSX.utils.sheet_to_row_object_array(a.Sheets[e])});console.log(i);i.forEach(e=>{if(e.Weight){e.Weight+="KG"}});var n=[...new Set(i)];console.log(n);const r=[...o,...n];localStorage.setItem("productsData",JSON.stringify(r));s.setData({products:r});s.refresh(true)};a.onerror=function(e){console.log(e)};a.readAsBinaryString(e)}},onClickSimulate:async function(){var e=this.byId("idAddProductsTableIn_simulate");var t=e.getSelectedItems();var t=e.getSelectedItems();console.log("Selected Items Count:",t.length);console.log("Selected Items:",t);const s=this.byId("parkingLotSelect");const o=s.getSelectedKey();if(t.length>0){var i=[];t.forEach(function(t){var s=t.getBindingContext("oJsonModelProd");if(s){var o={Product:e.getModel("oJsonModelProd").getProperty("Product",s),MaterialDescription:e.getModel("oJsonModelProd").getProperty("MaterialDescription",s),Quantity:e.getModel("oJsonModelProd").getProperty("Quantity",s),Volume:e.getModel("oJsonModelProd").getProperty("Volume",s),Weight:e.getModel("oJsonModelProd").getProperty("Weight",s)};i.push(o)}else{console.error("Binding context is undefined for a selected item.")}});console.log("Selected Items Data:",i);const a=i.reduce((e,t)=>e+t.Volume,0);function n(e){let t=e.match(/(\d+\.?\d*)/);return t?parseFloat(t[0]):0}const r=i.reduce((e,t)=>e+n(t.Weight),0);console.log("Overall Total Weight:",r);console.log("Overall Total Volume:",a);console.log("Overall Total Volume:",r);await this.onTruckDetailsLoad().then(e=>{let t=[];e.forEach(e=>{if(!o||e.truckType===o){const s=Math.ceil(a/e.volume);const o=s>0?s:1;t.push({truckType:e.truckType,volume:e.volume,numberOfTrucksNeeded:o})}});console.log("Required Trucks for Loading:");t.forEach(e=>{console.log(`- ${e.truckType}: ${e.numberOfTrucksNeeded} truck(s) needed (Capacity: ${e.volume} Kgs)`)});const s={OverallTotalVolume:a,overallTotalWeight:r,Products:i,TProducts:i.length,RequiredTrucks:t};const n=new sap.ui.model.json.JSONModel(s);this.getView().setModel(n,"resultModel");this.getOwnerComponent().setModel(n,"resultModel");const l=this.getView().getModel("resultModel").getData();console.log(l);this.getView().byId("idAddProductsTableIn_simulate").getBinding("items").refresh();this.getView().getModel("resultModel").refresh();this.MoveToNextScreen();this.getView().byId("idAddProductsTableIn_simulate").getBinding("items").refresh();this.getView().getModel("resultModel").refresh()}).catch(e=>{console.error("Error loading truck details:",e)})}else{console.log("No items are selected.")}},onTruckDetailsLoad:function(){return new Promise((e,t)=>{const s="/TruckTypes";const o=this.getView().getModel("ModelV2");o.read(s,{success:function(t){e(t.results)},error:function(e){t(e)}})})},onLoadRequiredTrucks:async function(){if(!this.oReqTruckDialog){this.oReqTruckDialog=await this.loadFragment("RequiredTruck")}this.oReqTruckDialog.setModel(this.getView().getModel("resultModel"),"resultModel");const e=this.getView().getModel("resultModel").getProperty("/Products");const t=e?e.length:0;this.oReqTruckDialog.open()},onTruckDialogClose:function(){this.byId("truckLoadingDialog").close()},MoveToNextScreen:function(){const e=d.getRouterFor(this);e.navTo("ReqTruck")},onLiveBinNumberTAble:function(e){let t=[];let i=e.getParameter("newValue");i=i.replace(/\s+/g,"");i=i.toUpperCase();if(i&&i.length>1){t.push(new s("sapProductno",o.EQ,i))}var a=this.byId("ProductsTable");var n=a.getBinding("items");n.filter(t)},onUploadMaterialCreation:function(e){this._import1(e.getParameter("files")&&e.getParameter("files")[0])},_import1:function(e){var t=this;if(e&&window.FileReader){var s=new FileReader;s.onload=function(e){var s=e.target.result;var o=XLSX.read(s,{type:"binary"});var i=[];o.SheetNames.forEach(function(e){const t=XLSX.utils.sheet_to_row_object_array(o.Sheets[e]);i=i.concat(t)});console.log(i);t.createProducts(i);t.localModel.refresh(true)};s.onerror=function(e){console.error("Error reading file:",e)};s.readAsBinaryString(e)}else{console.error("No file selected or FileReader not supported.")}},createProducts:async function(e){const t=this.getView().getModel("ModelV2");const s="/Materials";const o=[];for(const i of e){try{const e=this.checkProductExists(i["SAP Productno"]);if(e){console.warn(`Product with SAP Productno ${i["SAP Productno"]} already exists. Skipping creation.`);continue}const o={sapProductno:String(i["SAP Productno"]),length:String(i.Length),width:String(i.Width),height:String(i.Height),volume:String(i.Volume),uom:String(i.UOM),mCategory:String(i["Material Category"]),description:String(i.Description),EANUPC:String(i.EANUPC),weight:String(i.Weight),quantity:String(i.Quantity)};await this.createData(t,o,s);console.log(`Product created successfully: ${i.Description}`);this.byId("ProductsTable").getBinding("items").refresh()}catch(e){const t=`Error creating product ${i["SAP Productno"]}: ${e.message}`;console.error(t);o.push(t);c.error(t)}}},checkProductExists:function(e){if(!this.existingProducts||!Array.isArray(this.existingProducts)){console.error("existingProducts is not initialized or not an array.");return false}return this.existingProducts.some(t=>t.sapProductno===e)},loadExistingProducts:async function(){const e=this.getView().getModel("ModelV2");const t="/Materials";return new Promise((s,o)=>{e.read(t,{success:e=>{this.existingProducts=e.results;s()},error:e=>{console.error("Error loading existing products:",e);o(e)}})})},onClickSimulate11:function(){this.byId("Productarea").setVisible(false);this.byId("3dSimulator").setVisible(true)},onPressBacktomaterialupload:function(){this.byId("3dSimulator").setVisible(false);this.byId("Productarea").setVisible(true)},onSimulate:function(){var e=this.byId("parkingLotSelect").getSelectedKey();if(!e){c.warning("Please Select Truck Type");return}var t=this.byId("idproducthelp").getValue(),s=this.byId("idSystemvghjdfghkIdIhjnput_InitialView").getValue();if(!t){c.information("Please Enter Material!");return}if(!s){c.information("Please Enter  Quantity!");return}this.oProductRead(t,s)},oProductRead:async function(e,t){const i="/Materials",a=this.getView().getModel("ModelV2");const n=new s("sapProductno",o.EQ,e);try{const s=await this.readData(a,i,n);console.log("success");console.log(s);const o=s.results[0].volume;const l=s.results[0].weight;const c=parseFloat(l);const d=c*t+"KG";const u=o*t;const g=this.getView().getModel("oJsonModelProd");const h={Product:e,MaterialDescription:s.results[0].description,Quantity:t,Volume:u,Weight:d};let p=g.getProperty("/products")||[];p.push(h);g.setProperty("/products",p);this.byId("idproducthelp").setValue();this.byId("idSystemvghjdfghkIdIhjnput_InitialView").setValue();this.Blocking();localStorage.setItem("productsData",JSON.stringify(p));r.show("Materials read successfully!")}catch(e){c.warning("Please Enter Valid Material")}},Blocking:function(){var e=this.byId("idAddProductsTableIn_simulate").getItems().length;if(e>0){this.byId("parkingLotSelect").setEditable(false)}},loadProductsFromLocalStorage:function(){const e=this.getView().getModel("oJsonModelProd");if(!e){console.error("JSON Model 'oJsonModelProd' is not defined.");return}const t=localStorage.getItem("productsData");if(t){const s=JSON.parse(t);console.log("Loaded products from local storage:",s);if(Array.isArray(s)){e.setProperty("/products",s);console.log("Products set in model:",e.getProperty("/products"));this.getView().getModel("oJsonModelProd").refresh(true)}else{console.error("Loaded data is not an array:",s)}}else{console.log("No products found in local storage.")}},onRemoveSelectedProducts:function(){const e=this.getView().getModel("oJsonModelProd");const t=this.getView().byId("idAddProductsTableIn_simulate");const s=t.getSelectedItems();if(s.length>0){const o=e.getProperty("/products");const i=s.map(e=>e.getBindingContext("oJsonModelProd").getProperty("Product"));console.log("Selected Keys:",i);console.log("All Products:",o);const a=o.filter(e=>{const t=i.includes(e.Product);console.log(`Checking product: ${e.Product}, is selected: ${t}`);return!t});console.log("Filtered Products:",a);e.setProperty("/products",a);localStorage.setItem("productsData",JSON.stringify(a));t.getBinding("items").refresh();sap.m.MessageToast.show("Selected products have been removed.");this.Blocking()}else{e.setProperty("/products",[]);localStorage.removeItem("productsData");t.getBinding("items").refresh();sap.m.MessageToast.show("All products have been removed.")}},onNextInAddProduct:function(){var e=this.byId("idWizardIn_simulate");var t=e.getCurrentStep();e.nextStep();this._createGenericTile()},onPressStackBtn:async function(){if(!this.oStackDialog){this.oStackDialog=await this.loadFragment("Stack")}this.oStackDialog.open()},onCancelInStackDialog:function(){this.oStackDialog.close()},_createGenericStackTile:function(){var e=this.byId("VboxIdStacktiles")},onNextPressInSeconsSrInAddVehicleType:function(){debugger;this.getView().byId("idProcessQueueStep_changeQueue").setVisible(true)},onPressGenericTilePress:function(e){debugger;const t=e.getSource();const i=t.getHeader();this._init3DScene();const a=this.getOwnerComponent().getModel("ModelV2");const n="/TruckTypes";const r=new s("truckType",o.EQ,i);a.read(n,{filters:[r],success:function(e){if(e.results.length>0){const t=parseFloat(e.results[0].height);const s=parseFloat(e.results[0].length);const o=parseFloat(e.results[0].width);this._createContainer(t,s,o)}else{console.error("No data found for the selected truck type.")}}.bind(this),error:function(e){console.error("Error fetching truck type data:",e)}})},onPressAddProductInSimulate:function(){},onPressAddProductInSimulate:async function(){if(!this.oValueDialog){this.oValueDialog=await this.loadFragment("ValueHelp")}this.oValueDialog.open()},onValueHelpWithSuggestionsCancelPress:function(){this._oVHDWithSuggestions.close()},onPressTile:function(e){var t=e.getSource().getHeader();var s={Box:["https://www.searates.com/design/images/apps/load-calculator/boxes-layers.svg","https://www.searates.com/design/images/apps/load-calculator/boxes-height.svg","https://www.searates.com/design/images/apps/load-calculator/boxes-mass.svg"],Bigbags:["https://www.searates.com/design/images/apps/load-calculator/product-form/bigbags-layers.svg","https://www.searates.com/design/images/apps/load-calculator/product-form/bigbags-mass.svg","https://www.searates.com/design/images/apps/load-calculator/product-form/bigbags-height.svg"],Sacks:["https://www.searates.com/design/images/apps/load-calculator/product-form/sacks-layers.svg?3","https://www.searates.com/design/images/apps/load-calculator/product-form/sacks-height.svg?3","https://www.searates.com/design/images/apps/load-calculator/product-form/sacks-mass.svg?3"],Barrels:["https://www.searates.com/design/images/apps/load-calculator/barrels-layers.svg","https://www.searates.com/design/images/apps/load-calculator/barrels-height.svg","https://www.searates.com/design/images/apps/load-calculator/barrels-mass.svg"],Roll:["https://www.searates.com/design/images/apps/load-calculator/rolls-layers.svg","https://www.searates.com/design/images/apps/load-calculator/rolls-height.svg","https://www.searates.com/design/images/apps/load-calculator/rolls-mass.svg"],Pipes:["https://www.searates.com/design/images/apps/load-calculator/rolls-layers.svg","https://www.searates.com/design/images/apps/load-calculator/rolls-height.svg","https://www.searates.com/design/images/apps/load-calculator/rolls-mass.svg"],Bulk:[]};if(s[t]){var o=s[t];this.byId("idImageInStack").setSrc(o[0]);this.byId("idImage3InStack").setSrc(o[1]);this.byId("idImage43InStack").setSrc(o[2]);this.byId("imageDisplayHBox").setVisible(true)}},onPressAddButtonValueHelp:function(){var e=this.byId("idAssignedQueueTable_changeQueue");var t=e.getSelectedItems()},onPressBigBagsTile:function(){var e=new n({});this.getView().byId("idVbox4InStack").setModel(e,"oimage");var t=this.getView().byId("idVbox4InStack").getModel();const s=this.getView().byId("idVbox4InStack").getModel("oimage").getProperty("/");console.log(s)},_init3DScene:function(){if(this.scene){while(this.scene.children.length>0){this.scene.remove(this.scene.children[0])}}else{this.scene=new THREE.Scene;this.scene.background=new THREE.Color(16753920)}if(this.renderer){this.renderer.domElement.remove();this.renderer.dispose()}this.renderer=new THREE.WebGLRenderer({alpha:true});const e=document.getElementById("threejsCanvas");if(!e){console.error("Canvas container not found");return}this.renderer.setSize(800,600);this.renderer.outputEncoding=THREE.sRGBEncoding;this.renderer.shadowMap.enabled=true;e.appendChild(this.renderer.domElement);this.camera=new THREE.PerspectiveCamera(40,1e3/700,.1,1e3);this.camera.position.set(10,10,20);this.controls=new THREE.OrbitControls(this.camera,this.renderer.domElement);this.controls.enableDamping=true;this._addLighting();this._animate()},_createContainer:function(e,t,s){if(this.container){this.scene.remove(this.container);this.container.geometry.dispose();this.container.material.dispose()}const o=new THREE.BoxGeometry(t,e,s);const i=new THREE.MeshPhysicalMaterial({color:31743,metalness:.8,roughness:.4,opacity:.5,transparent:true,side:THREE.DoubleSide});this.container=new THREE.Mesh(o,i);this.container.castShadow=true;this.container.receiveShadow=true;this.container.position.set(0,e/2,0);this.scene.add(this.container);console.log("Container created with dimensions:",{height:e,length:t,width:s});var a=this.getView().byId("idAddProductsTableIn_simulate");var n=a.getSelectedItems();var r=n.map(function(e){return e.getBindingContext().getObject()});console.log("Selected Items Data as Objects:",r);this._createProducts(r,e,t,s)},_createProducts:function(e,t,s,o){let i=-s/2;let a=0;let n=-o/2;e.forEach(e=>{const r=parseInt(e.SelectedQuantity);const l=parseFloat(e.Productno.length);const c=parseFloat(e.Productno.height);const d=parseFloat(e.Productno.width);for(let u=0;u<r;u++){if(a+c>t||i+l>s/2||n+d>o/2){console.warn("Product does not fit in the container, skipping:",e);return}const r=new THREE.BoxGeometry(l,c,d);const u=new THREE.MeshStandardMaterial({color:65280,metalness:.5,roughness:.5});const g=new THREE.Mesh(r,u);g.castShadow=true;g.receiveShadow=true;g.position.set(i+l/2,a+c/2,n+d/2);this.scene.add(g);i+=l;if(i+l>s/2){i=-s/2;n+=d;if(n+d>o/2){n=-o/2;a+=c;if(a+c>t){console.warn("Container is full, cannot place more products.");return}}}}});console.log("Products dynamically positioned based on container size.")},_addLighting:function(){const e=new THREE.AmbientLight(16777215,.8);this.scene.add(e);const t=[{x:50,y:50,z:50},{x:-50,y:50,z:50},{x:50,y:50,z:-50},{x:-50,y:50,z:-50}];t.forEach(e=>{const t=new THREE.DirectionalLight(16777215,.5);t.position.set(e.x,e.y,e.z);this.scene.add(t)})},_animate:function(){const e=()=>{requestAnimationFrame(e);this.controls.update();this.renderer.render(this.scene,this.camera)};e()}})});
=======
sap.ui.define(["./BaseController","sap/ui/core/Fragment","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/m/IconTabBar","sap/m/IconTabFilter","sap/ui/model/json/JSONModel","sap/m/MessageToast","sap/ui/model/odata/v2/ODataModel","sap/m/MessageBox","sap/ui/core/UIComponent"],function(e,t,o,i,s,n,r,a,l,d,c){"use strict";return e.extend("com.app.artihcus.controller.MainPage",{onInit:function(){const e=new sap.ui.model.json.JSONModel({products:[]});this.getView().setModel(e,"oJsonModelProd");this.loadProductsFromLocalStorage();this.localModel=new sap.ui.model.json.JSONModel;this.getView().setModel(this.localModel,"localModel");const t=new r({sapProductno:"",length:"",width:"",height:"",volume:"",uom:"",vuom:"",wuom:"",muom:"",mCategory:"",description:"",EANUPC:"",weight:""});this.getView().setModel(t,"ProductModel");const o=new r({truckType:"",length:"",width:"",height:"",uom:"",tvuom:"M³",tuom:"M",volume:"",truckWeight:"",capacity:""});this.getView().setModel(o,"VehModel")},handleValueHelp:function(e){var o=e.getSource().getValue(),i=this.getView();if(!this._pValueHelpDialog){this._pValueHelpDialog=t.load({id:i.getId(),name:"com.app.artihcus.fragment.ProductsDialog",controller:this}).then(function(e){i.addDependent(e);return e})}this._pValueHelpDialog.then(function(e){e.open(o)})},handleValueHelpProductType:function(e){var o=e.getSource().getValue(),i=this.getView();if(!this._pProductsDialog){this._pProductsDialog=t.load({id:i.getId(),name:"com.app.artihcus.fragment.vehicleTypeDialog",controller:this}).then(function(e){i.addDependent(e);return e})}this._pProductsDialog.then(function(e){e.open(o)})},onPrintPressInProductsTable:function(){var e=this.byId("ProductsTable");var t=e.getItems();var o=[];var i=["SAP Productno","Description","EANUPC","Material Category","Length","Width","Height","Volume","UOM","Weight"];o.push(i);t.forEach(function(e){var t=e.getCells();var i=[];t.forEach(function(e){i.push(e.getText())});o.push(i)});var s=XLSX.utils.aoa_to_sheet(o);var n=XLSX.utils.book_new();XLSX.utils.book_append_sheet(n,s,"ProductsTable");XLSX.writeFile(n,"ProductsTable.xlsx")},onPressDownloadInAddVehicleTable:function(){var e=this.byId("idTruckTypeTable");var t=e.getItems();var o=[];var i=["TruckType","Length(M)","Width(M)","Height(M)","Volume(M)","Capacity","TruckWeight"];o.push(i);t.forEach(function(e){var t=e.getCells();var i=[];t.forEach(function(e){i.push(e.getText())});o.push(i)});var s=XLSX.utils.aoa_to_sheet(o);var n=XLSX.utils.book_new();XLSX.utils.book_append_sheet(n,s,"idProductsTableEdit");XLSX.writeFile(n,"VehicleTable.xlsx")},onPressPrintInListTable:function(){var e=this.byId("idListTable");var t=e.getItems();var o=[];var i=["S.No","Vehicle","Vehicle Type","Product","Product Type","Product Description","Dimensions","Volume","Weight","Capacity Used","Remaining Capacity"];o.push(i);t.forEach(function(e){var t=e.getCells();var i=[];t.forEach(function(e){i.push(e.getText())});o.push(i)});var s=XLSX.utils.aoa_to_sheet(o);var n=XLSX.utils.book_new();XLSX.utils.book_append_sheet(n,s,"idListTable");XLSX.writeFile(n,"ListOfProductsInVehicle.xlsx")},onCancelInCreateProductDialog:function(){this.byId("idCreateProduc33tDialog").close()},onPressInAddEquipment:async function(){if(!this.oCreateInAddEquipmentDialog){this.oCreateInAddEquipmentDialog=await this.loadFragment("CreateInAddEquipment")}this.oCreateInAddEquipmentDialog.open()},onCancelInCreateVehicleDialog:function(){this.byId("idCreateInAddddEquipmentDialog").close()},oOpenProductEdit:async function(){if(!this.oEditDialog){this.oEditDialog=await this.loadFragment("EditDialog")}this.oEditDialog.open()},onCancelInEditProductDialog:function(){this.byId("idEditProductDssialog").close()},onPressEditInAddEquipmentTable:async function(){if(!this.oEditInAddEquipment){this.oEditInAddEquipment=await this.loadFragment("EditInAddEquipment")}this.oEditInAddEquipment.open()},onCancelInEditVehicleDialog:function(){this.byId("idEditInssAddEquipmentDialog").close()},onPressAddInListTable:async function(){if(!this.oCreateInListDialog){this.oCreateInListDialog=await this.loadFragment("CreateInList")}this.oCreateInListDialog.open()},onCancelInListCreateDialog:function(){this.byId("idListssCreateDialog").close()},onPressEditInListTable:async function(){if(!this.oListEditDialog){this.oListEditDialog=await this.loadFragment("ListEditDialog")}this.oListEditDialog.open()},onCancelInListEditDialog:function(){this.byId("idListEdiwtDialog").close()},onCreateProduct:async function(){const e=this.getView().getModel("ProductModel"),t=e.getProperty("/"),o=this.getView().getModel("ModelV2"),i="/Materials";if(!t.sapProductno||!t.length||!t.width||!t.height||!t.mCategory||!t.description||!t.weight){console.log("Please Enter All Values");d.information("Please Enter All Values");return}var s=this.byId("idselectuom").getSelectedItem();if(s.getKey()===""){d.error("Please Select UOM!!");return}t.uom=s.getKey();var n=this.byId("uomSelect").getSelectedItem();if(n.getKey()===""){d.error("Please Select UOM!!");return}t.muom="PC";t.vuom="M³";t.wuom=n?n.getKey():"";var r;if(t.uom==="CM"){r=String(t.length/100)*String(t.width/100)*String(t.height/100);t.volume=String(r.toFixed(7))}else{r=String(t.length)*String(t.width)*String(t.height);t.volume=String(Math.round(r))}try{await this.createData(o,t,i);debugger;this.getView().byId("ProductsTable").getBinding("items").refresh();this.byId("idselectuom").setSelectedKey("");this.byId("uomSelect").setSelectedKey("");this.ClearingModel(true);a.show("Successfully Created!")}catch(e){a.show("Error at the time of creation")}},ClearingModel:function(){const e=this.getView().getModel("ProductModel");e.setProperty("/",{sapProductno:"",length:"",width:"",height:"",volume:"",uom:"",mCategory:"",description:"",EANUPC:"",weight:""})},onProductDel:async function(){const e=this.byId("ProductsTable"),t=e.getSelectedItems(),o=this.getView().getModel("ModelV2");if(t.length===0){d.information("Please select at least one product to delete.");return}try{await Promise.all(t.map(async e=>{const t=e.getBindingContext().getPath();await this.deleteData(o,t)}));this.getView().byId("ProductsTable").getBinding("items").refresh();a.show("Successfully Deleted")}catch(e){a.show("Error Occurs")}},onCreateVeh:async function(){const e=this.getView().getModel("VehModel"),t=e.getProperty("/"),o=this.getView().getModel("ModelV2"),i="/TruckTypes";if(!t.truckType||!t.length||!t.width||!t.height||!t.truckWeight||!t.capacity){d.warning("Please Enter all Values");return}var s=String(t.length)*String(t.width)*String(t.height);t.volume=parseFloat(s).toFixed(2);var n=this.byId("idvehtypeUOM").getSelectedItem();t.uom=n?n.getKey():"";try{await this.createData(o,t,i);debugger;this.getView().byId("idTruckTypeTable").getBinding("items").refresh();this.onCancelInCreateVehicleDialog();this.byId("idvehtypeUOM").setSelectedKey("");this.byId("parkingLotSelect").getBinding("items").refresh();this.ClearVeh(true);a.show("Successfully Created!")}catch(e){this.onCancelInCreateVehicleDialog();a.show("Error at the time of creation")}},ClearVeh:function(){const e=this.getView().getModel("VehModel");e.setProperty("/",{truckType:"",length:"",width:"",height:"",uom:"",volume:"",truckWeight:"",capacity:""})},onVehDel:async function(){const e=this.byId("idTruckTypeTable"),t=e.getSelectedItems(),o=this.getView().getModel("ModelV2");if(t.length===0){d.information("Please select at least one product to delete.");return}try{await Promise.all(t.map(async e=>{const t=e.getBindingContext().getPath();await this.deleteData(o,t)}));this.getView().byId("idTruckTypeTable").getBinding("items").refresh();this.byId("parkingLotSelect").getBinding("items").refresh();a.show("Successfully Deleted")}catch(e){a.show("Error Occurs")}},onRow:function(e){var t=e.getSource()},onEdit:async function(){var e=this.byId("idTruckTypeTable").getSelectedItem();if(!e){d.information("Please select at least one Row for edit!");return}const t=e.getBindingContext().getObject();await this.onPressEditInAddEquipmentTable();this.byId("editTruckTypeInput").setValue(t.truckType);this.byId("editLengthInput").setValue(t.length);this.byId("editWidthInput").setValue(t.width);this.byId("editHeightInput").setValue(t.height);this.byId("editTruckWeightInput").setValue(t.truckWeight);this.byId("editCapacityInput").setValue(t.capacity)},onSave:async function(){const e={truckType:this.byId("editTruckTypeInput").getValue(),length:this.byId("editLengthInput").getValue(),width:this.byId("editWidthInput").getValue(),height:this.byId("editHeightInput").getValue(),volume:"",truckWeight:this.byId("editTruckWeightInput").getValue(),capacity:this.byId("editCapacityInput").getValue()};const t=e;var o=String(t.length)*String(t.width)*String(t.height);t.volume=parseFloat(o).toFixed(2);const i=this.byId("editTruckTypeInput").getValue();const s=this.getView().getModel("ModelV2");const n=`/TruckTypes('${i}')`;try{await this.updateData(s,t,n);this.getView().byId("idTruckTypeTable").getBinding("items").refresh();this.onCancelInEditVehicleDialog();this.onClearEditDialog();a.show("Successfully Updated")}catch(e){this.onCancelInEditVehicleDialog();this.onClearEditDialog();a.show("Error")}},onClearEditDialog:function(){this.byId("editTruckTypeInput").setValue("");this.byId("editLengthInput").setValue("");this.byId("editWidthInput").setValue("");this.byId("editHeightInput").setValue("");this.byId("editTruckWeightInput").setValue("");this.byId("editCapacityInput").setValue("")},onPressEditInProductsTable:async function(){var e=this.byId("ProductsTable").getSelectedItem();if(!e){d.information("Please select at least one Row for edit!");return}const t=e.getBindingContext().getObject();await this.oOpenProductEdit();this.byId("editProductNoInput").setValue(t.sapProductno);this.byId("editDescriptionInput").setValue(t.description);this.byId("editEANUPCInput").setValue(t.EANUPC);this.byId("editCategoryInput").setValue(t.mCategory);this.byId("editproLengthInput").setValue(t.length);this.byId("editprodWidthInput").setValue(t.width);this.byId("editprodHeightInput").setValue(t.height);this.byId("editUOMInput").setValue(t.uom);this.byId("editWeightInput").setValue(t.weight)},onSaveProduct:async function(){const e={sapProductno:this.byId("editProductNoInput").getValue(),description:this.byId("editDescriptionInput").getValue(),EANUPC:this.byId("editEANUPCInput").getValue(),mCategory:this.byId("editCategoryInput").getValue(),length:this.byId("editproLengthInput").getValue(),width:this.byId("editprodWidthInput").getValue(),height:this.byId("editprodHeightInput").getValue(),volume:"",uom:this.byId("editUOMInput").getValue(),weight:this.byId("editWeightInput").getValue()};const t=e;var o=String(t.length)*String(t.width)*String(t.height);t.volume=parseFloat(o).toFixed(2);const i=this.byId("editProductNoInput").getValue();const s=this.getView().getModel("ModelV2");const n=`/Materials('${i}')`;try{await this.updateData(s,t,n);this.getView().byId("ProductsTable").getBinding("items").refresh();this.onCancelInEditProductDialog();this.onClearEditProdDialog();a.show("Successfully Updated")}catch(e){this.onCancelInEditProductDialog();this.onClearEditProdDialog();a.show("Error")}},onClearEditProdDialog:function(){this.byId("editProductNoInput").setValue("");this.byId("editDescriptionInput").setValue("");this.byId("editEANUPCInput").setValue("");this.byId("editCategoryInput").setValue("");this.byId("editproLengthInput").setValue("");this.byId("editprodWidthInput").setValue("");this.byId("editprodHeightInput").setValue("");this.byId("editUOMInput").setValue("");this.byId("editWeightInput").setValue("")},onTruckDetails:function(){const e=this.byId("idcdsse").getValue(),t=this.getView().getModel("ModelV2"),s="/TruckTypes";const n=new o("truckType",i.EQ,e);var r=this;t.read(s,{filters:[n],success:function(e){const t=e.results[0].volume,o=e.results[0].capacity},error:function(e){}})},onProdDetails:function(){const e=this.byId("idproducthelp").getValue(),t=this.getView().getModel("ModelV2"),s="/Materials";const n=new o("sapProductno",i.EQ,e);var r=this;t.read(s,{filters:[n],success:function(e){const t=e.results[0].volume;const o=r.byId("idSystemvgwddshjkIdInput_InitialView").getValue();const i=o/t;r.byId("idSystemvghjdfghkIdIhjnput_InitialView").setValue(i)},error:function(e){}})},onUpload:function(e){this._import(e.getParameter("files")&&e.getParameter("files")[0])},_import:function(e){var t=this;let o=t.getView().getModel("oJsonModelProd"),i=o.getData().products;var s={};if(e&&window.FileReader){var n=new FileReader;n.onload=function(e){var t=e.target.result;var n=XLSX.read(t,{type:"binary"});n.SheetNames.forEach(function(e){s=XLSX.utils.sheet_to_row_object_array(n.Sheets[e])});console.log(s);s.forEach(e=>{if(e.Weight){e.Weight+="KG"}});var r=[...new Set(s)];console.log(r);const a=[...i,...r];localStorage.setItem("productsData",JSON.stringify(a));o.setData({products:a});o.refresh(true)};n.onerror=function(e){console.log(e)};n.readAsBinaryString(e)}},onClickSimulate:async function(){var e=this.byId("myTable");var t=e.getSelectedItems();var t=e.getSelectedItems();console.log("Selected Items Count:",t.length);console.log("Selected Items:",t);const o=this.byId("parkingLotSelect");const i=o.getSelectedKey();if(t.length>0){var s=[];t.forEach(function(t){var o=t.getBindingContext("oJsonModelProd");if(o){var i={Product:e.getModel("oJsonModelProd").getProperty("Product",o),MaterialDescription:e.getModel("oJsonModelProd").getProperty("MaterialDescription",o),Quantity:e.getModel("oJsonModelProd").getProperty("Quantity",o),Volume:e.getModel("oJsonModelProd").getProperty("Volume",o),Weight:e.getModel("oJsonModelProd").getProperty("Weight",o)};s.push(i)}else{console.error("Binding context is undefined for a selected item.")}});console.log("Selected Items Data:",s);const n=s.reduce((e,t)=>e+t.Volume,0);function r(e){let t=e.match(/(\d+\.?\d*)/);return t?parseFloat(t[0]):0}const a=s.reduce((e,t)=>e+r(t.Weight),0);console.log("Overall Total Weight:",a);console.log("Overall Total Volume:",n);console.log("Overall Total Volume:",a);await this.onTruckDetailsLoad().then(e=>{let t=[];e.forEach(e=>{if(!i||e.truckType===i){const o=Math.ceil(n/e.volume);const i=o>0?o:1;t.push({truckType:e.truckType,volume:e.volume,numberOfTrucksNeeded:i})}});console.log("Required Trucks for Loading:");t.forEach(e=>{console.log(`- ${e.truckType}: ${e.numberOfTrucksNeeded} truck(s) needed (Capacity: ${e.volume} Kgs)`)});const o={OverallTotalVolume:n,overallTotalWeight:a,Products:s,TProducts:s.length,RequiredTrucks:t};const r=new sap.ui.model.json.JSONModel(o);this.getView().setModel(r,"resultModel");this.getOwnerComponent().setModel(r,"resultModel");const l=this.getView().getModel("resultModel").getData();console.log(l);this.getView().byId("myTable").getBinding("items").refresh();this.getView().getModel("resultModel").refresh();this.MoveToNextScreen();this.getView().byId("myTable").getBinding("items").refresh();this.getView().getModel("resultModel").refresh()}).catch(e=>{console.error("Error loading truck details:",e)})}else{console.log("No items are selected.")}},onTruckDetailsLoad:function(){return new Promise((e,t)=>{const o="/TruckTypes";const i=this.getView().getModel("ModelV2");i.read(o,{success:function(t){e(t.results)},error:function(e){t(e)}})})},onLoadRequiredTrucks:async function(){if(!this.oReqTruckDialog){this.oReqTruckDialog=await this.loadFragment("RequiredTruck")}this.oReqTruckDialog.setModel(this.getView().getModel("resultModel"),"resultModel");const e=this.getView().getModel("resultModel").getProperty("/Products");const t=e?e.length:0;this.oReqTruckDialog.open()},onTruckDialogClose:function(){this.byId("truckLoadingDialog").close()},MoveToNextScreen:function(){const e=c.getRouterFor(this);e.navTo("ReqTruck")},onLiveBinNumberTAble:function(e){let t=[];let s=e.getParameter("newValue");s=s.replace(/\s+/g,"");s=s.toUpperCase();if(s&&s.length>1){t.push(new o("sapProductno",i.EQ,s))}var n=this.byId("ProductsTable");var r=n.getBinding("items");r.filter(t)},onUploadMaterialCreation:function(e){this._import1(e.getParameter("files")&&e.getParameter("files")[0])},_import1:function(e){var t=this;if(e&&window.FileReader){var o=new FileReader;o.onload=function(e){var o=e.target.result;var i=XLSX.read(o,{type:"binary"});var s=[];i.SheetNames.forEach(function(e){const t=XLSX.utils.sheet_to_row_object_array(i.Sheets[e]);s=s.concat(t)});console.log(s);t.createProducts(s);t.localModel.refresh(true)};o.onerror=function(e){console.error("Error reading file:",e)};o.readAsBinaryString(e)}else{console.error("No file selected or FileReader not supported.")}},createProducts:async function(e){const t=this.getView().getModel("ModelV2");const o="/Materials";const i=[];for(const s of e){try{const e=this.checkProductExists(s["SAP Productno"]);if(e){console.warn(`Product with SAP Productno ${s["SAP Productno"]} already exists. Skipping creation.`);continue}const i={sapProductno:String(s["SAP Productno"]),length:String(s.Length),width:String(s.Width),height:String(s.Height),volume:String(s.Volume),uom:String(s.UOM),mCategory:String(s["Material Category"]),description:String(s.Description),EANUPC:String(s.EANUPC),weight:String(s.Weight)};await this.createData(t,i,o);console.log(`Product created successfully: ${s.Description}`);this.byId("ProductsTable").getBinding("items").refresh()}catch(e){const t=`Error creating product ${s["SAP Productno"]}: ${e.message}`;console.error(t);i.push(t);d.error(t)}}},checkProductExists:function(e){if(!this.existingProducts||!Array.isArray(this.existingProducts)){console.error("existingProducts is not initialized or not an array.");return false}return this.existingProducts.some(t=>t.sapProductno===e)},loadExistingProducts:async function(){const e=this.getView().getModel("ModelV2");const t="/Materials";return new Promise((o,i)=>{e.read(t,{success:e=>{this.existingProducts=e.results;o()},error:e=>{console.error("Error loading existing products:",e);i(e)}})})},onClickSimulate11:function(){this.byId("Productarea").setVisible(false);this.byId("3dSimulator").setVisible(true)},onPressBacktomaterialupload:function(){this.byId("3dSimulator").setVisible(false);this.byId("Productarea").setVisible(true)},onSimulate:function(){var e=this.byId("parkingLotSelect").getSelectedKey();if(!e){d.warning("Please Select Truck Type");return}var t=this.byId("idproducthelp").getValue(),o=this.byId("idSystemvghjdfghkIdIhjnput_InitialView").getValue();if(!t){d.information("Please Enter Material!");return}if(!o){d.information("Please Enter  Quantity!");return}this.oProductRead(t,o)},oProductRead:async function(e,t){const s="/Materials",n=this.getView().getModel("ModelV2");const r=new o("sapProductno",i.EQ,e);try{const o=await this.readData(n,s,r);console.log("success");console.log(o);const i=o.results[0].volume;const l=o.results[0].weight;const d=parseFloat(l);const c=d*t+"KG";const u=i*t;const g=this.getView().getModel("oJsonModelProd");const h={Product:e,MaterialDescription:o.results[0].description,Quantity:t,Volume:u,Weight:c};let p=g.getProperty("/products")||[];p.push(h);g.setProperty("/products",p);this.byId("idproducthelp").setValue();this.byId("idSystemvghjdfghkIdIhjnput_InitialView").setValue();this.Blocking();localStorage.setItem("productsData",JSON.stringify(p));a.show("Materials read successfully!")}catch(e){d.warning("Please Enter Valid Material")}},Blocking:function(){var e=this.byId("myTable").getItems().length;if(e>0){this.byId("parkingLotSelect").setEditable(false)}},loadProductsFromLocalStorage:function(){const e=this.getView().getModel("oJsonModelProd");if(!e){console.error("JSON Model 'oJsonModelProd' is not defined.");return}const t=localStorage.getItem("productsData");if(t){const o=JSON.parse(t);console.log("Loaded products from local storage:",o);if(Array.isArray(o)){e.setProperty("/products",o);console.log("Products set in model:",e.getProperty("/products"));this.getView().byId("myTable").getBinding("items").refresh();this.getView().getModel("oJsonModelProd").refresh(true)}else{console.error("Loaded data is not an array:",o)}}else{console.log("No products found in local storage.")}},onRemoveSelectedProducts:function(){const e=this.getView().getModel("oJsonModelProd");const t=this.getView().byId("myTable");const o=t.getSelectedItems();if(o.length>0){const i=e.getProperty("/products");const s=o.map(e=>e.getBindingContext("oJsonModelProd").getProperty("Product"));console.log("Selected Keys:",s);console.log("All Products:",i);const n=i.filter(e=>{const t=s.includes(e.Product);console.log(`Checking product: ${e.Product}, is selected: ${t}`);return!t});console.log("Filtered Products:",n);e.setProperty("/products",n);localStorage.setItem("productsData",JSON.stringify(n));t.getBinding("items").refresh();sap.m.MessageToast.show("Selected products have been removed.");this.Blocking()}else{e.setProperty("/products",[]);localStorage.removeItem("productsData");t.getBinding("items").refresh();sap.m.MessageToast.show("All products have been removed.")}}})});
>>>>>>> 85e8d7d18b33587cc78e9e671c82285acd30657e
//# sourceMappingURL=MainPage.controller.js.map